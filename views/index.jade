extends layout
include mixins/mixins_index

block content
    section.main
        .clearfix
            +login_form

            .mdl-spinner.mdl-spinner--single-color.mdl-js-spinner.is-active(ng-show='loading')
                
            #blur.ng-hide(ng-show="editing && !loading")
            
            //- Table for Students for Center and Admin
            table.mdl-data-table.mdl-js-data-table.mdl-shadow--2dp.ng-hide(ng-controller="TableController", ng-show="loggedIn && !isStudent", ng-init="update_students()", ng-table='tableParams', show-filter='true', style="max-height:80vh;overflow-y:scroll;float:left;display:block;")
                thead
                    tr
                        th.mdl-data-table__cell--non-numeric(ng-show="selectMultiple")
                        th.mdl-data-table__cell--non-numeric
                        th.mdl-data-table__cell--non-numeric
                            <a href="" ng-click="order('phone')"> PHONE NO. </a>
                        th.mdl-data-table__cell--non-numeric 
                            <a href="" ng-click="order('email')"> E-MAIL </a>                            
                        th.mdl-data-table__cell--non-numeric 
                            <a href="" ng-click="order('name')"> NAME </a>                                                    
                        th.mdl-data-table__cell--non-numeric 
                            <a href="" ng-click="order('dateofbirth')"> DATE OF BIRTH </a>                                                    
                        th.mdl-data-table__cell--non-numeric 
                            <a href="" ng-click="order('gender')"> GENDER </a>                                                    
                        th.mdl-data-table__cell--non-numeric 
                            <a href="" ng-click="order('parentname')"> PARENT NAME </a>                                                    
                        th.mdl-data-table__cell--non-numeric 
                            <a href="" ng-click="order('tshirtsize')"> T-SHIRT </a>                                                    
                        th.mdl-data-table__cell--non-numeric 
                            <a href="" ng-click="order('status')"> STATUS </a>                                                    
                        th.mdl-data-table__cell--non-numeric 
                            <a href="" ng-click="order('dateCreated')"> DATE OF ENTRY </a>                                                    
                        th.mdl-data-table__cell--non-numeric(ng-show='isAdmin') 
                            <a href="" ng-click="order('programmename')"> PROGRAMME NAME </a>                                                    
                        th.mdl-data-table__cell--non-numeric 
                            <a href="" ng-click="order('centername')"> CENTER / SCHOOL Name </a>                                                    
                        th.mdl-data-table__cell--non-numeric 
                            <a href="" ng-click="order('level')"> LEVEL </a>                                                    
                        th.mdl-data-table__cell--non-numeric 
                            <a href="" ng-click="order('group')"> GROUP </a>                                                    
                        th.mdl-data-table__cell--non-numeric 
                            <a href="" ng-click="order('category')"> CATEGORY </a>                            
                        th.mdl-data-table__cell--non-numeric 
                            <a href="" ng-click="order('paymentapproved')"> PAYMENT APPROVED </a>                            
                        th.mdl-data-table__cell--non-numeric(ng-show='isAdmin') 
                            <a href="" ng-click="order('paymentdate')"> PAYMENT DATE </a>                            
                        th.mdl-data-table__cell--non-numeric(ng-show='isAdmin') 
                            <a href="" ng-click="order('transactionno')"> TRANSACTION NO. </a>                            
                        th.mdl-data-table__cell--non-numeric(ng-show='isAdmin') 
                            <a href="" ng-click="order('paymentmode')"> PAYMENT MODE </a>                            
                        th.mdl-data-table__cell--non-numeric(ng-show='isAdmin') 
                            <a href="" ng-click="order('bankname')"> BANK NAME </a>                            
                        th.mdl-data-table__cell--non-numeric(ng-show='isAdmin') 
                            <a href="" ng-click="order('dateCreated')"> Actions </a>                            
                tbody   
                    tr
                        td.mdl-data-table__cell--non-numeric(ng-show="selectMultiple")
                        td.mdl-data-table__cell--non-numeric
                        td
                            input(type="text",ng-model="search.phone") 
                        td
                            input(type="text",ng-model="search.email") 
                        td
                            input(type="text",ng-model="search.name") 
                        td
                            input(type="text",ng-model="search.dateofbirth") 
                        td
                            input(type="text",ng-model="search.gender")
                        td
                            input(type="text",ng-model="search.parentname") 
                        td
                            input(type="text",ng-model="search.tshirtsize") 
                        td
                            input(type="text",ng-model="search.status") 
                        td
                            input(type="text",ng-model="search.dateCreated") 
                        td(ng-show='isAdmin')
                            input(type="text",ng-model="search.programmename") 
                        td
                            input(type="text",ng-model="search.centername") 
                        td
                            input(type="text",ng-model="search.level") 
                        td
                            input(type="text",ng-model="search.group") 
                        td
                            input(type="text",ng-model="search.category") 
                        td
                            input(type="text",ng-model="search.paymentapproved") 
                        td(ng-show='isAdmin')
                            input(type="text",ng-model="search.paymentdate") 
                        td(ng-show='isAdmin')
                            input(type="text",ng-model="search.transactionno") 
                        td(ng-show='isAdmin')
                            input(type="text",ng-model="search.paymentmode") 
                        td(ng-show='isAdmin')
                            input(type="text",ng-model="search.bankname") 
                        td(ng-show='isAdmin')

                    tr(ng-repeat="f in student_list | orderBy:predicate:reverse | filter:search track by $index", ng-style="f.status=='payment' && {'background-color':'burlywood'} || f.status=='admin' && {'background-color':'peachpuff'}")
                        th(class="mdl-data-table__cell--non-numeric",ng-show="selectMultiple") 
                            input(type="checkbox",ng-model="f.checked",ng-change="selectedOneMultiple(f)",ng-show="f.status=='payment'",style="width:21px;height:21px;")
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)") {{$index+1}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)") {{f.phone}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)") {{f.email}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)") {{f.name}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)") {{f.dateofbirth | date:'dd-MMM-yyyy'}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)") {{f.gender}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)") {{f.parentname}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)") {{f.tshirtsize}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)") {{f.status}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)") {{f.dateCreated | date:'dd-MMM-yyyy'}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)",ng-show='isAdmin') {{f.programmename}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)")
                            span(ng-if="f.centername != undefined")
                                | {{f.centername}}
                            span(ng-if="f.schoolname != undefined")
                                | {{f.schoolname}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)") {{f.level}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)") {{f.group}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)") {{f.category}}
                        td(class="mdl-data-table__cell--non-numeric",ng-click="studentClick(f.status, f._id)") {{f.paymentapproved}}
                        td(class="mdl-data-table__cell--non-numeric",ng-show='isAdmin') {{f.paymentdate | date:'dd-MMM-yyyy'}}
                        td(class="mdl-data-table__cell--non-numeric",ng-show='isAdmin') {{f.transactionno}}
                        td(class="mdl-data-table__cell--non-numeric",ng-show='isAdmin') {{f.paymentmode}}
                        td(class="mdl-data-table__cell--non-numeric",ng-show='isAdmin') {{f.bankname}}
                        td(class="mdl-data-table__cell--non-numeric",ng-show='isAdmin') 
                            button(style="border:none;color:white;padding:8px;border-radius:5px;background:#f44336;cursor:pointer;box-shadow: 0 0 0 0 rgba(0,0,0,.2), 0 0 0 0 rgba(0,0,0,.14), 0 0 0 0 rgba(0,0,0,.12);margin: 0 3px;",confirmed-click="deleteStudent(f._id)",ng-confirm-click="Are you sure you want to delete this entry? The action cannot be undone.") Delete
                            button(style="border:none;color:white;padding:8px;border-radius:5px;background:#3f51b5;cursor:pointer;box-shadow: 0 0 0 0 rgba(0,0,0,.2), 0 0 0 0 rgba(0,0,0,.14), 0 0 0 0 rgba(0,0,0,.12);margin: 0 3px;",confirmed-click="approveStudent(f)",ng-confirm-click="Are you sure you want to Confirm payment for this entry?",ng-show="f.status=='admin' && !f.paymentapproved") Approve

            //- Student Form
            div(ng-controller="FormController", ng-show='loggedIn && isStudent', style='margin-top:100px;')
                div
                    ncy-breadcrumb
                .container
                    .row
                        .col-md-8.col-md-offset-2
                            form(name='registration', ng-submit='save_student()', ng-show='showStudentStatus')
                                .panel.panel-default(style='margin-top:20px;')
                                    .panel-body(style='height:70vh; overflow-y:scroll; background-color:white;border-radius: 10px;padding: 15px;')
                                       div(ng-if="studentStatus.status == 'open'")
                                            h5#swal2-title.swal2-title(style="color:#0080ff;margin:10px 20px;") Dear {{studentStatus.name}} <br><br>
                                            h6#swal2-title.swal2-title(style="color:black;margin:10px 20px;") Thankyou for the registration at Aloha. Your current status is  Open. <br> <br>
                                            h6#swal2-title.swal2-title(style="color:black;margin:10px 20px;") Please make a payment of <b> Rs.550 towards Registration and of Rs.250 if opted for T-Shirt </b> to the concerned authorities. <br><br>
                                            h6#swal2-title.swal2-title(style="color:black;margin:10px 20px;") Do not forget to come back after <b> 20th October 2018 </b> to print the hall ticket. <br><br>
                                            h6#swal2-title.swal2-title(style="color:black;margin:10px 20px;") Incase of any doubts, please mail us at aloha.karnataka@gmail.com <br><br>
                                            h6#swal2-title.swal2-title(style="color:black;margin:10px 20px;") Wishing your kid all the very best! <br><br>
                                            <a ng-href="{{file}}" target="_blank" style="color:blue;margin:20px;">Download Terms & Conditions</a>                                                                                             

            //- Card for center to be updated
            .demo-card-wide.mdl-card.mdl-shadow--2dp(ng-controller="CardController", ng-show="$parent.editing")
                .mdl-card__supporting-text
                    div(style="width:80%;float:left;overflow-y:scroll;max-height:80vh;")
                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                            input.mdl-textfield__input(type="text", ng-model='student.programmename', ng-disabled="true", ng-required="true")
                            label.mdl-textfield__label !{t('Select Programme')}

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label(ng-show="student.programmename == 'Center Programme'")
                            input.mdl-textfield__input(type="text", ng-model='student.centername', ng-disabled="true", ng-required="true")
                            label.mdl-textfield__label !{t('Select Center')}

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label(ng-show="student.programmename == 'School Programme'")
                            input.mdl-textfield__input(type="text", ng-model='student.schoolname', ng-disabled="true", ng-required="true")
                            label.mdl-textfield__label !{t('Select School')}
                        
                        //- .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                        //-     input.mdl-textfield__input(type="email", ng-model='student.centercode', ng-disabled="true", ng-required="true")
                        //-     label.mdl-textfield__label !{t('Center Code')}

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                            input.mdl-textfield__input(type="text", ng-model="student.phone", ng-minlength="10", ng-disabled="true", ng-maxlength="10", ng-required="true")
                            label.mdl-textfield__label !{t('Phone Number')}

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                            input.mdl-textfield__input(type="email", ng-model="student.email", ng-required="true")
                            label.mdl-textfield__label !{t('Email')}

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                            input.mdl-textfield__input(type="text", ng-model="student.name", ng-required="true")
                            label.mdl-textfield__label !{t('Name Of Student')}

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                            input.mdl-textfield__input(type="text", ng-model="student.parentname", ng-required="true")
                            label.mdl-textfield__label !{t('Parent Name')}

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                            label.mdl-textfield__label !{t('Gender')}
                            label(style="float:left;width:50%;")
                                input.mdl-textfield__input(type="radio", ng-model="student.gender", ng-required="true", value="Male", style="float:left;width:10%;margin-top: 3px;")
                                | Male
                            label(style="float:left;width:50%;")
                                input.mdl-textfield__input(type="radio", ng-model="student.gender", ng-required="true", value="Female", style="float:left;width:10%;margin-top: 3px;")
                                | Female

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                            textarea.mdl-textfield__input(ng-model="student.address", ng-required="true", rows="2")
                            label.mdl-textfield__label !{t('Address')}

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                            input.mdl-textfield__input(type="date", ng-model="student.dateofbirth", ng-required="true")
                            label.mdl-textfield__label !{t('Date Of Birth')}

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                            label.mdl-textfield__label !{t('Do you want a T-Shirt?')}                                            
                            switch(ng-model="student.tshirtrequired",on="YES",off="NO",class="green")

                        div.mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label(ng-show="student.tshirtrequired")
                            span !{t('T-Shirt Size')}
                            select.mdc-select__native-control(ng-model='student.tshirtsize', ng-options='x for x in tshirtsizeoptions')
                                option(value="" disabled selected)
                                    | Select T-Shirt Size 

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label(ng-show="student.programmename == 'Center Programme'")
                            input.mdl-textfield__input(type="date", ng-model="student.registrationdate", ng-required="true")
                            label.mdl-textfield__label !{t('Date Of Student Registration at Aloha')}

                        div.mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label(ng-show="student.programmename == 'School Programme'")
                            span !{t('Group')}
                            select.mdc-select__native-control(ng-model='student.group', ng-options='x for x in schoolgroups', ng-change="onGroupChange(student.group, 'School')")
                                option(value="" disabled selected)
                                    | Select Group 

                        div.mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label(ng-show="student.programmename == 'Center Programme'")
                            span !{t('Group')}
                            select.mdc-select__native-control(ng-model='student.group', ng-options='x for x in centergroups', ng-change="onGroupChange(student.group, 'Center')")
                                option(value="" disabled selected)
                                    | Select Group 

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                            input.mdl-textfield__input(type="text", ng-model="student.category", ng-disabled="true")
                            label.mdl-textfield__label !{t('Category')}
        
                        p(ng-show="age.years != -1 && age.months != -1", style="display:-webkit-inline-box;margin-left:-27%;")
                            | Age as on 31/Sept/2018 - {{age.years}} Yrs, {{age.months}} Month

                        div.mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label(ng-show="student.group == 'MA' || student.group == 'MAS'")
                            span !{t('Level Applying For')}
                            select.mdc-select__native-control(ng-model='student.level', ng-options='x for x in malevels')
                                option(value="" disabled selected)
                                    | Select Level Applying For 

                        div.mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label(ng-show="student.group == 'TT' || student.group == 'TTS'")
                            span !{t('Level Applying For')}
                            select.mdc-select__native-control(ng-model='student.level', ng-options='x for x in ttlevels')
                                option(value="" disabled selected)
                                    | Select Level Applying For 

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label(ng-show="student.programmename == 'Center Programme'")
                            input.mdl-textfield__input(type="text", ng-model="student.presentlevel")
                            label.mdl-textfield__label !{t('Present Running Level')}

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label(ng-show="student.programmename == 'Center Programme'")
                            input.mdl-textfield__input(type="text", ng-model="student.presentweek")
                            label.mdl-textfield__label !{t('Present Running Week')}

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label(ng-show="student.programmename == 'School Programme'")
                            input.mdl-textfield__input(type="text", ng-model="student.class")
                            label.mdl-textfield__label !{t('Class Studying In')}

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label(ng-show="student.programmename == 'School Programme'")
                            input.mdl-textfield__input(type="text", ng-model="student.section")
                            label.mdl-textfield__label !{t('Section Studying In')}

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                            input.mdl-textfield__input(type="text", ng-model="student.lastyearlevel")
                            label.mdl-textfield__label !{t('If Participated Last Year, Which Level?')}

                    div(style="width:20%;float:left;")
                        br
                        img(ng-src='https://s3.ap-south-1.amazonaws.com/alohakarnataka/{{student.photo}}', style="border:3px solid grey;width: 100%; height: auto;margin-top:50px;", ng-if="student.photo != undefined && getFileExtension(student.photo)")
                        a(ng-href="https://s3.ap-south-1.amazonaws.com/alohakarnataka/{{student.photo}}",target="_blank",style="color:blue;padding-top:30px;font-size:20px;",ng-if="student.photo != undefined && !getFileExtension(student.photo)") Download Photo (Format not supported to display)
                        br
                        br
                        br
                        img(ng-src='https://s3.ap-south-1.amazonaws.com/alohakarnataka/{{student.birthcertificate}}', style="border:3px solid grey;width: 100%; height: auto;margin-top:10px;", ng-if="student.birthcertificate != undefined && getFileExtension(student.birthcertificate)")
                        a(ng-href="https://s3.ap-south-1.amazonaws.com/alohakarnataka/{{student.birthcertificate}}",target="_blank",style="color:blue;padding-top:30px;font-size:20px;",ng-if="student.birthcertificate != undefined && !getFileExtension(student.birthcertificate)") Download Birth Certificate (Format not supported to display)

                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label(ng-show="student.photo == undefined", style="width:90%;margin-top: 50px;")
                            span !{t('Upload Student Image')}  
                            input(type = 'file', file-model = 'myFile', ng-src='{{student.photo}}', accept="image/*")
                        
                        .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label(ng-show="student.birthcertificate == undefined", style="width:90%;margin-top: 50px;")
                            span !{t('Upload Birth Certificate / Aadhaar Card')}  
                            input(type = 'file', file-model = 'myFile1', ng-src='{{student.birthcertificate}}', accept="image/*")

                p(style="text-align:center;color:red;font-weight:bolder;margin:0;padding:0;")
                    {{msg}}

                .mdl-card__actions.mdl-card--border
                    a#save-btn.mdl-button.mdl-js-button.mdl-button--raised.mdl-button--colored.mdl-js-ripple-effect(ng-click="save_student()")
                        | !{t('SAVE')}

                .mdl-card__menu
                    button.mdl-button.mdl-button--icon.mdl-js-button.mdl-js-ripple-effect(ng-click="close_card()")
                        i.material-icons close

            //- Card for Payment details to be added
            .demo-card-wide.mdl-card.mdl-shadow--2dp.paymenting(ng-show="paymenting")
                .mdl-card__supporting-text
                    div.mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                        span !{t('Payment Mode')}
                        select.mdc-select__native-control(ng-model='payment.paymentmode', ng-options='x for x in paymentmodes', ng-required="true")
                            option(value="" disabled selected)
                                | Select Payment Mode

                    div.mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                        span !{t('Bank')}
                        select.mdc-select__native-control(ng-model='payment.bankname', ng-options='x for x in banknames', ng-required="true")
                            option(value="" disabled selected)
                                | Select Bank

                    .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                        input.mdl-textfield__input(type="text", ng-model="payment.transactionno", ng-required="true")
                        label.mdl-textfield__label !{t('Transaction Number')}

                    .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label
                        span !{t('Payment / Cheque Date')}
                        input.mdl-textfield__input(type="date", ng-model="payment.paymentdate", ng-required="true")
                        //- label.mdl-textfield__label !{t('Payment / Cheque Date')}

                p(style="text-align:center;color:red;font-weight:bolder;margin:0;padding:0;")
                    {{msgs}}

                .mdl-card__actions.mdl-card--border
                    a#save-btn.mdl-button.mdl-js-button.mdl-button--raised.mdl-button--colored.mdl-js-ripple-effect(ng-click="save_payment()")
                        | !{t('SAVE')}

                .mdl-card__menu
                    button.mdl-button.mdl-button--icon.mdl-js-button.mdl-js-ripple-effect(ng-click="cancel_payment()")
                        i.material-icons close
